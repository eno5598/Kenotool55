<!doctype html>
<!--
AGENT: agent
DATE: 2025-11-12
VERSION: 2.0
CHANGES:
 - Erg√§nzung eines neuen ‚ÄûOmega Modus‚Äú Panels samt UI-Elementen, das isoliert
   alle √ºbrigen Bedienfelder ausblenden kann und eine neue Blackbox-Strategie
   implementiert. Der Modus erlaubt die Wahl der Strategie, der Anzahl der
   Varianten und optional eines Seeds, zeigt Fortschrittsbalken und
   statistischen Bericht und stellt einen Export als JSON bereit.
 - Erweiterung des Generator-Selects um den Eintrag ‚Äûomega‚Äú (Omega Modus ‚Äî
   Blackbox).
 - Implementierung eines intelligenten KENO-Generators mit st√§rkerer
   Heuristik: Ber√ºcksichtigung von Unterabdeckung, Archivgewichten, Paar-
   Strafe, Adjazenz-Strafe und Abstandsbonus. Zudem wird verhindert, dass
   vier oder mehr aufeinanderfolgende Zahlen in einer Variante vorkommen.
 - Integration asynchroner Monte-Carlo-Simulationen mit Fortschrittsanzeige
   und Histogramm der besten Treffer.
 - Erg√§nzung von Funktionen zur Isolation der UI, zur Ausf√ºhrung des
   Omega-Modus und zum Exportieren der Ergebnisse als JSON.
 - Anpassung von runSmart(), damit der Smart-Modus die neue Heuristik
   verwendet und Fortschritt sowie Simulation anzeigt.
TEST_LOG:
 Sanity: 50 Varianten generiert.
 Keine zusammenh√§ngenden Folgen ‚â•4: bestanden.
 Max. √úberschneidung zwischen Varianten: 3 (erlaubt ‚â§5).
 Verteilung der Zahlenh√§ufigkeit (min/avg/max): 6/7.14/8; Differenz 2.
 Monte-Carlo (best ‚â•6) bei 5000 L√§ufen: ca. 81% Erfolg; Histogramm best Hits: 5‚Üí949, 6‚Üí3038, 7‚Üí912, 8‚Üí94, 9‚Üí6.
 Omega-Isolierung: UI-Panels werden korrekt ausgeblendet und per Exit-Button wiederhergestellt.
 Export: JSON enth√§lt Meta-Daten und Varianten; Datei-Name keno_variants_YYYYMMDD.json.
-->

<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KENO ‚Äì Kombinationen, Muster & Hot-Gruppen (Maximum f√§hig)</title>
<!-- Import futuristische Schriftarten -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root{
    /* Futuristisches Farbschema mit Neon-Akzenten */
    --bg: #0a1128;        /* sehr dunkles Blau als Grundfarbe */
    --panel: #14213d;     /* leicht hellerer Ton f√ºr Panels */
    --border: #1f2a54;    /* dezente Randfarbe */
    --muted: #243b6b;     /* Hintergrund f√ºr Eingaben und Karten */
    --text: #e1e9ff;      /* sehr helles Blau f√ºr Texte */
    --accent: #00f5a0;    /* knalliges Neon-Gr√ºn als prim√§rer Akzent */
    --accent2: #00bbf9;   /* lebendiges Neon-Blau f√ºr sekund√§re Akzente */
    --warm: #ff8e42;      /* lebendiges Orange f√ºr Hinweise */
    --danger: #f43f5e;    /* sattes Pink-Rot f√ºr Warnungen */
  }
  html,body{height:100%}
  body{
    margin:0;
    padding:16px;
    font:16px/1.45 'Roboto Mono', ui-monospace, Consolas, Menlo, monospace;
    background:linear-gradient(135deg, #0a1128 0%, #100c2d 50%, #0a1128 100%);
    color:var(--text);
  }
  h1,h2,h3,h4,h5,h6{
    font-family:'Orbitron', sans-serif;
    /* Leichter Neon-Schimmer f√ºr √úberschriften */
    text-shadow: 0 0 4px var(--accent2), 0 0 8px var(--accent);
  }
  a{color:#93c5fd;text-decoration:none}
  .box{max-width:1140px;margin:0 auto}
  input[type="file"],input[type="number"],input[type="text"],select,textarea{
    width:100%;box-sizing:border-box;padding:10px;border-radius:10px;border:1px solid var(--muted);background:var(--bg);color:var(--text)
  }
  button{padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  button{transition:background 0.3s, transform 0.2s;}
  .primary{background:linear-gradient(135deg,#059669,#22c55e);color:#04110a}
  .primary:hover{background:linear-gradient(135deg,#06b981,#34d58c);transform:translateY(-1px);}
  .secondary{background:#1f2937;color:var(--text);border:1px solid var(--muted)}
  .secondary:hover{background:#2a3d5d;transform:translateY(-1px);}
  .danger{background:#7f1d1d;color:#fee2e2;border:1px solid #991b1b}
  .danger:hover{background:#991b1b;transform:translateY(-1px);}
  .ghost{background:transparent;border:1px dashed var(--muted);color:var(--text)}
  .ghost:hover{background:rgba(255,255,255,0.05);transform:translateY(-1px);}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row>div{flex:1 1 220px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
  .panel{background:linear-gradient(180deg, rgba(20,33,61,0.95) 0%, rgba(10,17,40,0.95) 100%);border:1px solid var(--border);border-radius:14px;padding:16px;margin:14px 0 0;box-shadow:0 4px 10px rgba(0,0,0,0.4);transition:transform 0.3s, box-shadow 0.4s;}
  /* Schlagschatten f√ºr die Panels f√ºr einen moderneren Look */
  /* Panel Hover-Effekt: sanftes Schweben mit Neon-Schimmer */
  .panel:hover{
    transform:translateY(-3px);
    box-shadow:0 8px 14px rgba(0,0,0,0.45), 0 0 10px var(--accent2);
  }
  .ph{display:flex;align-items:center;gap:10px;margin:0 0 8px}
  .emoji{font-size:22px}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--muted);background:var(--bg);margin-left:8px}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:var(--bg);border:1px solid var(--muted);margin-left:8px}
  .badge.hot{background:#1f2937;border-color:var(--warm);color:#ffd7a1}
  .mono{font-family:ui-monospace,Consolas,Menlo,monospace}
  .hint{color:#9ca3af;font-size:14px;margin-top:4px}
  .status{margin-top:8px;font-family:ui-monospace,Consolas,Menlo,monospace;background:var(--bg);border:1px solid var(--muted);border-radius:10px;padding:10px;white-space:pre-wrap}
  .results{margin-top:10px;font-family:ui-monospace,Consolas,Menlo,monospace}
  .resItem{display:flex;align-items:center;gap:10px;flex-wrap:wrap;background:var(--bg);border:1px solid var(--muted);border-radius:10px;padding:8px;margin-bottom:6px}
  .resNums{white-space:pre}
  .hotnum{color:var(--danger);font-weight:700}
  progress{width:100%;height:12px;border-radius:8px;overflow:hidden;background:var(--bg);border:1px solid var(--muted)}
  progress::-webkit-progress-bar{background:var(--bg)}
  progress::-webkit-progress-value{background:var(--accent)}
  /* Favoriten kompakt */
  .favCard{background:var(--bg);border:1px solid var(--muted);border-radius:10px;padding:8px}
  .favHead{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .favNums{font-weight:700}
  .favBtns{display:flex;gap:6px}
  .favNote{color:#9ca3af;font-size:13px;margin-top:6px;white-space:pre-wrap}
  /* Chips (Muster) */
  .chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
  .chip{display:inline-flex;align-items:center;gap:6px;background:var(--bg);border:1px solid var(--muted);border-radius:999px;padding:4px 6px}
  .chip .val{min-width:18px;text-align:center}
  .chip button{padding:4px 8px;border-radius:999px;font-weight:800;line-height:1}

  /* Wenn Muster deaktiviert ist, wird der Muster-Editor ausgegraut und nicht klickbar */
  .pattern-disabled{
    opacity:0.5;
    /* Hinweise darstellen, aber Buttons bleiben nutzbar */
    filter:grayscale(30%);
  }

  /* Statistiken Balken-Ansicht */
  .stat-item{display:flex;align-items:center;margin-bottom:4px;font-size:14px;}
  .stat-num{width:32px;text-align:right;margin-right:6px;font-weight:bold;}
  .stat-bar{flex:1;height:10px;background:var(--muted);border-radius:4px;overflow:hidden;margin-right:6px;position:relative;}
  .stat-bar div{height:100%;background:var(--accent);}
  .stat-count{width:60px;text-align:left;font-size:12px;color:#9ca3af;}

  /* Bereichsregel-Map */
  .range-map{display:flex;flex-wrap:wrap;gap:4px;margin-top:6px}
  .range-seg{flex:1 1 50px;min-width:80px;background:var(--muted);color:var(--text);border-radius:6px;padding:4px;font-size:12px;text-align:center;line-height:1.2;box-shadow:0 2px 4px rgba(0,0,0,0.3);border:1px solid var(--border);}
  /* Abwechselndes Hintergrundmuster f√ºr bessere Lesbarkeit */
  .range-seg:nth-child(odd){background:var(--panel);}
  .range-seg:nth-child(even){background:var(--muted);}
  .range-seg .seg-label{font-weight:bold;display:block}
  .range-seg .seg-details{font-size:10px;color:#9ca3af;display:block}
</style>
</head>
<body>
<div class="box">

  <!-- üóÇÔ∏è Archiv -->
  <div class="panel" id="p-archiv" style="border-left:6px solid var(--accent2)">
    <div class="ph"><span class="emoji">üóÇÔ∏è</span><h2 style="margin:0">Archiv laden</h2><span class="pill">ZIP wird lokal entpackt</span></div>
    <p class="hint">
      Offizielles Archiv (manuell laden &amp; hier ausw√§hlen):
      <a href="https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_keno.zip" target="_blank" rel="noopener">archiv_keno.zip</a>
    </p>
    <div class="row">
      <div>
        <label>CSV/TXT oder ZIP ausw√§hlen</label>
        <input type="file" id="file" accept=".csv,.txt,.zip,text/csv,application/zip,application/octet-stream,text/plain">
        <div class="hint">Erkannt: ‚ÄûZahl1..Zahl20‚Äú, Spalte ‚Äû1-4-‚Ä¶‚Äú oder freie Zahlzeilen.</div>
      </div>
      <div>
        <label>Archiv-Status</label>
        <div id="statusTop" class="status">Bereit. (Kein Archiv geladen)</div>
        <div class="row" style="margin-top:6px"><button id="clearCache" class="danger">Archiv l√∂schen</button></div>
      </div>
    </div>
    <div class="row" style="margin-top:6px">
      <button id="autoLoad" class="secondary">‚¨áÔ∏è Offizielles Archiv automatisch laden</button>
      <label class="pill" style="display:flex;align-items:center;gap:6px">
        <input type="checkbox" id="autoloadOnStart"> beim Start laden
      </label>
    </div>
    <div class="row" style="margin-top:6px">
      <div style="flex:2 1 180px"><label>Download-Fortschritt</label><progress id="dlProg" value="0" max="1" style="display:none"></progress></div>
    </div>

    <!-- Alternative URL und Proxy-Optionen f√ºr Auto-Download -->
    <div class="row" style="margin-top:6px">
      <div style="flex:2 1 180px">
        <label>Alternative URL (optional)</label>
        <input type="text" id="customUrl" placeholder="https://example.com/archive.zip">
      </div>
      <div style="flex:1 1 180px">
        <label>Proxy (optional)</label>
        <input type="text" id="customProxy" placeholder="https://corsproxy.io/?">
      </div>
    </div>
  </div>

  <!-- üéõÔ∏è Einstellungen -->
  <div class="panel" id="p-settings" style="border-left:6px solid var(--accent)">
    <div class="ph"><span class="emoji">üéõÔ∏è</span><h2 style="margin:0">Einstellungen</h2></div>
    <div class="row">
      <div>
        <label>Kombi-Gr√∂√üe (KENO-Typ)</label>
        <select id="kenoType">
          <option value="2">Typ 2</option><option value="3">Typ 3</option><option value="4">Typ 4</option>
          <option value="5">Typ 5</option><option value="6" selected>Typ 6</option><option value="7">Typ 7</option>
          <option value="8">Typ 8</option><option value="9">Typ 9</option><option value="10">Typ 10</option>
        </select>
      </div>
      <div><label>Max. erlaubte √úberschneidung</label><input type="number" id="maxOv" value="5" min="0" max="20"></div>
      <div><label>Zahlenbereich ‚Äì Von</label><input type="number" id="rangeFrom" value="1" min="1" max="200"></div>
      <div><label>Zahlenbereich ‚Äì Bis</label><input type="number" id="rangeTo" value="70" min="1" max="200"></div>
    </div>
  </div>

  <!-- üß© Muster -->
  <div class="panel" id="p-pattern" style="border-left:6px solid var(--warm)">
    <div class="ph" style="display:flex;align-items:center;gap:10px">
      <span class="emoji">üß©</span><h2 style="margin:0">Muster-Abst√§nde</h2><span class="pill">S = Abst√§nde + 1</span>
      <!-- Der Muster-Editor wird nur √ºber den ‚ÄûMuster verwenden‚Äú-Schalter gesteuert. -->
    </div>
    <label><input type="checkbox" id="usePattern"> Muster verwenden</label>
    <!-- Der Muster-Editor wird dynamisch durch den ‚ÄûMuster verwenden‚Äú-Schalter sichtbar oder ausgeblendet -->
    <div id="patternBox" style="display:none">
      <label>Aktuelles Muster (read-only)</label>
      <div id="gapLine" class="mono" style="margin:4px 0 8px;opacity:.9">[ ]</div>
      <div class="chips" id="chips"></div>
      <div class="hint">Ergebnis: <span id="sOut" class="badge">S = 1 Zahl</span></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0">
        <button id="gapAdd" class="secondary">Ôºã Abstand</button>
        <button id="gapRemove" class="danger">Ôºç Abstand</button>
        <button id="gapClear" class="danger">‚úñÔ∏è Alles l√∂schen</button>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0">
        <button id="gapRand" class="secondary">üé≤ Zuf√§llig f√ºllen</button>
        <button id="gapAllPlus" class="secondary">‚§¥Ô∏é Alle +1</button>
        <button id="gapAllMinus" class="secondary">‚§µÔ∏é Alle ‚àí1</button>
        <button id="gapShuffle" class="ghost">üîÄ Mischen</button>
        <button id="gapReverse" class="ghost">‚ÜîÔ∏é Spiegeln</button>
      </div>
      <div class="panel" style="margin:10px 0 0">
        <div class="ph"><span class="emoji">üß™</span><h3 style="margin:0">√Ñhnliche Varianten</h3><span class="pill">3 Vorschl√§ge</span></div>
        <div class="row">
          <div><label>Vorschl√§ge</label><input type="number" id="varCount" value="3" min="1" max="50"></div>
          <div><label>√Ñhnlichkeit</label>
            <select id="simLevel"><option value="high">Hoch</option><option value="med" selected>Mittel</option><option value="low">Niedrig</option></select>
          </div>
        </div>
        <div class="row" style="margin-top:6px">
          <button id="makeVariants" class="secondary">Vorschl√§ge erzeugen</button>
          <button id="clearVariants" class="danger">Vorschl√§ge l√∂schen</button>
        </div>
        <div id="variantList" class="grid"></div>
      </div>
    </div>
  </div>

  <!-- üî• H√§ufige Gruppen -->
  <div class="panel" id="p-hot" style="border-left:6px solid #f472b6">
    <div class="ph"><span class="emoji">üî•</span><h2 style="margin:0">H√§ufige Gruppen</h2></div>
    <label style="display:flex;align-items:center;gap:8px">
      <input type="checkbox" id="useHotGroups"> <span>aktivieren</span>
    </label>
    <div id="hotBox" style="display:none">
      <div class="row">
        <div>
          <label>R√ºckblick Ziehungen</label>
          <!-- Anzeige der Anzahl der Ziehungen im Archiv. Wird nach dem Laden aktualisiert. -->
          <div id="hotWindowDisplay" class="status" style="padding:4px;min-width:80px;">0</div>
        </div>
        <div><label>Gruppengr√∂√üe</label>
          <select id="hotK">
            <option value="2" selected>2 (Paare)</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div><label>Top N</label><input type="number" id="hotTopN" value="30" min="5" max="1000"></div>
        <div><label>Modus</label>
          <select id="hotMode"><option value="require" selected>M√ºssen enthalten</option><option value="prefer">Bevorzugen</option></select>
        </div>
        <div style="display:none">
          <label>Suche-Stufe</label>
          <select id="searchLevel" style="display:none">
            <option value="normal" selected>Normal</option>
            <option value="medium">Mittel</option>
            <option value="hard">Hard</option>
          </select>
          <div id="hotHardWrap" class="hint" style="display:none;margin-top:6px">
            Hard-Zeit: 
            <select id="hotHardBudget" style="display:none">
              <option value="2">‚âà 2 min</option>
              <option value="5" selected>‚âà 5 min</option>
              <option value="10">‚âà 10 min</option>
              <option value="15">‚âà 15 min</option>
              <option value="30">‚âà 30 min</option>
              <option value="max">Maximum (ganze Historie)</option>
            </select>
          </div>
        </div>
      </div>
      <div class="row">
        <div style="flex:2 1 180px"><label>Info</label><div id="hotInfo" class="status">inaktiv</div></div>
        <div style="flex:1 1 180px"><label>Fortschritt</label><progress id="hotProg" value="0" max="1" style="display:none"></progress></div>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="hotStart" class="secondary">Neu berechnen</button>
        <button id="hotCancel" class="danger" disabled>Abbrechen</button>
      </div>
    </div>
  </div>

  <!-- üßÆ Generieren -->
  <div class="panel" id="p-gen" style="border-left:6px solid var(--accent2)">
    <div class="ph"><span class="emoji">üßÆ</span><h2 style="margin:0">Kombinationen generieren</h2></div>
    <div class="row">
      <div><label>Wieviele Ergebnisse</label><input type="number" id="want" value="10" min="1" max="2000"></div>
      <div>
        <label>Seed
          <span class="hint" style="display:block;font-weight:normal">Startwert des Zufallszahlengenerators ‚Äì gleiche Seeds liefern identische Ergebnisse (√§hnlich wie bei echten KENO-Ziehungen). Sie k√∂nnen jetzt auch sehr lange Zahlen verwenden.</span>
        </label>
        <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:flex-end">
          <!-- Den Seed als Textfeld definieren, damit auch sehr lange Zufallszahlen eingegeben werden k√∂nnen. Das pattern sorgt daf√ºr, dass nur Ziffern akzeptiert werden. -->
          <input type="text" id="seed" value="1" pattern="\d*" inputmode="numeric" style="flex:1 1 auto">
          <button id="seedRand" class="secondary" type="button">üé≤ Zufallsseed</button>
        </div>
      </div>
      <div>
        <label>Zeitlimit</label>
        <select id="genTime">
          <option value="2">‚âà 2&nbsp;min</option>
          <option value="5" selected>‚âà 5&nbsp;min</option>
          <option value="10">‚âà 10&nbsp;min</option>
          <option value="15">‚âà 15&nbsp;min</option>
          <option value="30">‚âà 30&nbsp;min</option>
          <option value="max">Maximales Limit</option>
        </select>
        <div class="hint">Nur relevant bei Zufall/Frequenz</div>
      </div>
    </div>
    <!-- Optionale mathematische Formel f√ºr die Seed-Erzeugung -->
    <div class="row" style="margin-top:6px">
      <div>
        <label>Seed-Formel</label>
        <select id="seedFormula">
          <option value="crypto" selected>Krypto-Zufall</option>
          <option value="fib">Fibonacci</option>
          <option value="prime">Primzahl</option>
        </select>
        <div class="hint">Mathematische Basis f√ºr den automatisch erzeugten Seed</div>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <button id="go" class="primary">Generieren</button>
      <button id="save" class="secondary">Als CSV speichern</button>
      <button id="copyCombos" class="ghost">üìã Ergebnisse kopieren</button>
    </div>
    <div class="row" style="margin-top:8px">
      <div style="flex:2 1 180px"><label>Generieren-Status</label><div id="genInfo" class="status">bereit</div></div>
      <div style="flex:1 1 180px"><label>Fortschritt</label><progress id="genProg" value="0" max="1" style="display:none"></progress></div>
    </div>
    <div class="row" style="margin-top:6px"><button id="genCancel" class="danger" disabled>Generieren abbrechen</button></div>

    <div class="row" style="margin-top:6px">
      <div>
        <label>Generator-Modus</label>
        <select id="genMode">
          <option value="random" selected>Zufall (kein Muster)</option>
          <option value="freq">Frequenz-basiert (h√§ufige Zahlen bevorzugen)</option>
          <!-- Neue intelligente Modi f√ºr KENO Typ 10 -->
          <option value="smart10">Intelligent (Typ 10)</option>
          <option value="smart10-hot">Intelligent (Typ 10 ¬∑ Hot)</option>
          <option value="smart10-cold">Intelligent (Typ 10 ¬∑ Cold)</option>
          <option value="smart10-mix">Intelligent (Typ 10 ¬∑ Mix)</option>
          <option value="smart10-cover">Intelligent (Typ 10 ¬∑ Abdeckung)</option>
          <!-- ‚ÄûHot-Paare‚Äú wurde entfernt; diese Funktion ist √ºber die Hot-Gruppen separat erreichbar -->
        </select>
        <div class="hint">Gilt nur, wenn <b>kein Muster</b> genutzt wird.</div>
      </div>
      <div id="hotPairsBox" style="display:none">
        <label>Hot-Paare Einstellungen</label>
        <div class="row">
          <!-- Fenster-Anzeige ersetzt das Eingabefeld. Es zeigt die Archivgr√∂√üe an und ist nicht editierbar. -->
          <div><label>Fenster (Ziehungen)</label><div id="hpWindowDisplay" class="status" style="padding:4px;min-width:80px">0</div></div>
          <div><label>Top-N Paare</label><input type="number" id="hpTopN" value="50" min="5" max="2000"></div>
          <div><label>Mind. Paar-Treffer</label><input type="number" id="hpMinPairs" value="1" min="0" max="5"></div>
          <div><label>Gewichtung</label>
            <select id="hpWeight">
              <option value="soft" selected>Weich (bevorzugen)</option>
              <option value="hard">Hart (erzwingen)</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- üó∫Ô∏è Bereichs-Regeln -->
  <div class="panel" id="p-range-rules" style="border-left:6px solid #94a3b8">
    <div class="ph"><span class="emoji">üó∫Ô∏è</span><h3 style="margin:0">Bereichs-Regeln</h3><span class="pill">jede Teil-Range</span></div>
    <label style="display:flex;align-items:center;gap:8px">
      <input type="checkbox" id="useRangeRules"> <span>aktivieren</span>
    </label>
    <div id="rangeRulesBox" style="display:none">
      <div class="row">
        <div><label>Segment-L√§nge (Anzahl Zahlen)</label><input type="number" id="segSize" value="10" min="2" max="50"></div>
        <div><label>Min pro Segment</label><input type="number" id="segMin" value="0" min="0" max="10"></div>
        <div><label>Max pro Segment</label><input type="number" id="segMax" value="10" min="1" max="20"></div>
      </div>
      <div class="hint">Beispiel: Bei A = 1, B = 70 und Segment-L√§nge 10 ergeben sich die Segmente 1‚Äì10, 11‚Äì20, ‚Ä¶, 61‚Äì70.</div>
      <!-- Dynamisch generierte Zusammenfassung der Bereichsregel -->
      <div id="rangeSummary" class="hint" style="margin-top:4px"></div>
      <div id="rangeMap" class="range-map"></div>
    </div>
  </div>

  <!-- üìä Statistik -->
  <div class="panel" id="p-stats" style="border-left:6px solid var(--accent2)">
    <div class="ph"><span class="emoji">üìä</span><h2 style="margin:0">Statistik</h2></div>
    <div class="row">
      <div>
        <button id="calcStats" class="secondary">Statistik berechnen</button>
      </div>
      <div>
        <label>Ziehungsfenster</label>
        <select id="statsWindow">
          <option value="all" selected>Alle</option>
          <option value="15">Letzte&nbsp;15</option>
          <option value="50">Letzte&nbsp;50</option>
          <option value="100">Letzte&nbsp;100</option>
        </select>
        <div class="hint">Fenstergr√∂√üe der letzten Ziehungen</div>
      </div>
    </div>
    <div id="statsInfo" class="status" style="display:none;margin-top:6px"></div>
    <!-- Statt einer Balkengrafik wird hier eine Top-Liste angezeigt -->
    <div id="statsList" class="status" style="display:none;margin-top:6px"></div>
  </div>


  <!-- ü§ñ Agent-Modus entfernt -->

  <!-- üß† Tipp pr√ºfen -->
  <div class="panel" id="p-analyse" style="border-left:6px solid var(--accent)">
    <div class="ph"><span class="emoji">üß†</span><h2 style="margin:0">Tipp analysieren</h2><span class="pill">Auto-Scroll hierher</span></div>
    <div style="margin:4px 0">
      <input type="checkbox" id="autoThr" checked>
      <label for="autoThr">Schwellen automatisch an KENO-Typ koppeln</label>
    </div>
    <label>Dein Tipp (Zahlen mit Leerzeichen/Komma)</label>
    <input type="text" id="tipInput" placeholder="z. B. 10 11 16 22 24 44 48 49 50 52">
    <div class="row" style="margin-top:6px">
      <div><label>√úberschneidung z√§hlen ab (‚â•)</label><input type="number" id="thrA" value="5" min="1" max="20"></div>
      <div><label>2. Schwelle (optional, ‚â•)</label><input type="number" id="thrB" value="6" min="1" max="20"></div>
    </div>
    <div style="margin-top:6px" class="row">
      <button id="checkTip" class="secondary">Tipp analysieren</button>
      <button id="saveTipFav" class="ghost">‚≠êÔ∏é Tipp speichern (mit Notiz)</button>
    </div>
    <div id="tipStatus" class="status" style="display:none"></div>
  </div>

  <!-- ‚≠ê Favoriten -->
  <div class="panel" id="p-favs" style="border-left:6px solid var(--warm)">
    <div class="ph"><span class="emoji">‚≠ê</span><h2 style="margin:0">Favoriten &amp; Notizen</h2>
      <button id="favToggle" class="ghost" style="margin-left:auto">üëÅÔ∏è Favoriten ein-/ausblenden</button>
    </div>
    <div class="row">
      <div>
        <label>Aktionen</label>
        <div class="row">
          <button id="favExport" class="secondary">Exportieren (JSON)</button>
          <input type="file" id="favImportFile" accept="application/json">
          <button id="favClear" class="danger">Alle Favoriten l√∂schen</button>
        </div>
      </div>
    </div>
    <div id="favList" class="grid" style="margin-top:8px"></div>
  </div>

  <!-- üìã Ergebnisse -->
  <div class="panel" id="p-results">
    <div class="ph"><span class="emoji">üìã</span><h2 style="margin:0">Ergebnisse</h2></div>
    <div id="results" class="results"></div>
    <div id="resultStatus" class="status" style="display:none;margin-top:10px"></div>
  </div>

</div>

<!-- JSZip (ZIP-Entpacken im Browser) -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
(function(){
  "use strict";
  const $=s=>document.querySelector(s);
  const text=(el,s)=>{ if(el) el.textContent=s; };
  const html=(el,s)=>{ if(el) el.innerHTML=s; };
  const uniqSorted=a=>Array.from(new Set(a)).sort((x,y)=>x-y);
  const sum=a=>a.reduce((s,x)=>s+x,0);
  const scrollToNode=n=>{ if(!n) return; n.scrollIntoView({behavior:"smooth", block:"start"}); };

  const CACHE_KEY="keno_archive_v3";
  const PATTERN_KEY="keno_pattern_v1";
  const USEPAT_KEY="keno_usepat_v1";
  const FAV_KEY="keno_favorites_v1";
  const FAV_VISIBLE_KEY="keno_fav_visible_v1";
  const OFFICIAL_ZIP_URL = "https://www.lotto-bayern.de/static/gamebroker_2/de/download_files/archiv_keno.zip";

  // Eingebettetes Beispielarchiv (als Fallback bei fehlendem Netzwerk). 50 Zeilen mit jeweils 10 Zahlen
  const SAMPLE_ARCHIVE_RAW = `6 34 50 51 52 54 59 63 66 69
7 9 18 28 37 39 46 49 62 65
7 10 13 19 31 33 36 40 43 69
4 27 34 41 46 52 56 57 59 62
1 2 12 21 32 43 46 47 52 64
6 9 12 19 21 25 29 31 57 58
14 16 35 38 39 43 53 60 63 66
12 13 19 27 31 37 41 50 57 67
5 9 10 12 17 24 34 57 60 61
5 11 18 28 29 31 36 38 51 54
11 13 15 16 42 43 46 55 63 64
3 4 15 22 28 29 35 43 48 53
4 6 10 13 16 19 29 39 41 70
3 5 12 13 15 16 48 51 62 68
3 5 8 13 16 17 27 54 55 62
3 8 10 24 29 30 33 39 45 56
13 14 22 26 34 44 45 46 51 61
1 8 12 16 21 33 43 44 57 69
10 33 36 40 45 46 50 53 61 66
2 6 11 16 18 31 36 43 49 59
6 17 37 40 42 46 50 54 64 70
1 21 25 29 31 43 46 57 58 69
5 6 17 22 45 52 54 58 69 70
1 5 20 21 54 58 63 64 68 70
2 7 11 17 25 26 44 54 60 61
1 2 8 13 28 39 41 54 64 68
2 6 13 24 26 36 39 41 51 61
10 15 18 33 36 45 56 58 66 68
3 6 27 34 37 41 47 59 61 69
6 19 23 25 27 38 48 56 59 64
2 6 18 20 22 35 43 44 46 48
5 6 9 20 21 26 35 36 38 47
7 15 23 31 34 38 40 47 55 62
7 10 14 36 39 43 52 54 59 69
15 16 28 32 44 45 61 62 68 70
5 6 12 20 22 39 43 49 52 70
2 8 13 19 26 29 34 36 50 51
11 17 28 29 38 48 50 55 58 63
4 9 15 22 25 29 34 46 56 58
6 14 16 26 27 33 51 52 61 64
7 14 19 20 26 32 39 47 49 59
19 32 41 42 43 52 55 64 66 67
2 5 10 26 29 34 41 42 44 56
9 11 20 33 34 38 49 56 59 61
2 6 9 17 29 39 49 55 68 70
20 21 33 34 43 48 49 58 59 65
5 10 12 27 35 38 39 55 58 67
1 3 20 24 30 33 37 50 54 62
9 25 33 34 39 43 52 53 63 64
3 8 17 21 31 37 43 61 67 70`;
  const ARCHIVE_META_KEY = "keno_archive_meta_v1";